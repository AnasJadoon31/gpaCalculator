<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>GPA Calculator</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: cursive;
      }
      #title {
        color: bisque;
        font-size: 48px;
        text-shadow: 0 0 30px rgb(229, 234, 208);
        text-decoration: underline;
        text-align: center;
      }
      html {
        background-color: black;
      }
      form {
        display: flex;
        flex-direction: column;
        align-items: flex-start;
        padding-top: 100px;
        width: 400px;
        margin: 0 auto;
      }
      .form-group {
        display: flex;
        align-items: center;
        margin-bottom: 10px;
        width: 100%;
      }
      label {
        color: bisque;
        width: 120px;
        text-align: left;
      }
      input,
      select {
        color: black;
        border-radius: 5px;
        padding: 10px;
        width: 250px;
        margin-left: 10px;
      }
      #addCourses {
        margin-right: 20px;
        margin-left: auto;
        margin-top: 10px;
        padding: 10px 25px;
        border-radius: 10px;
        background-color: transparent;
        color: bisque;
        border: 1px solid bisque;
        cursor: pointer;
      }
      #addCourses:hover {
        background-color: bisque;
        color: black;
      }
      /* Responsive Table Styling */
      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 30px;
      }
      th,
      td {
        color: bisque;
        padding: 15px;
        text-align: center;
        border: 3px solid bisque;
        word-wrap: break-word;
      }
      .actionButton {
        margin-top: 10px;
        padding: 10px 25px;
        border-radius: 10px;
        background-color: transparent;
        color: bisque;
        border: 1px solid bisque;
        cursor: pointer;
      }
      .actionButton:hover {
        background-color: bisque;
        color: black;
      }
      .actionButton:not(:last-child) {
        margin-right: 10px; /* Adjust the value as needed */
      }
      #totalGPA {
        width: 100%; /* Make it span the full width of its parent */
        text-align: left; /* Align text to the left */
        margin: 0; /* Remove any default margin */
        padding-left: 20px; /* Optional: add left padding for spacing from the edge */
      }
      #GPA {
        color: bisque;
        text-align: left;
        margin-left: 0; /* Ensures it aligns to the left */
      }
      @media screen and (max-width: 480px) {
        th,
        td {
          padding: 10px;
          font-size: 14px;
        }
        form {
          width: 90%;
        }
        label {
          width: 100px;
        }
        input,
        select {
          width: calc(100% - 110px);
        }
      }
    </style>
  </head>
  <body>
    <header>
      <h1 id="title">GPA Calculator</h1>
    </header>
    <main>
      <form id="courseInfo">
        <div class="form-group">
          <label for="course">Course Name:</label>
          <input type="text" id="course" name="course" required />
        </div>
        <div class="form-group">
          <label for="creditHours">Credit Hours:</label>
          <select name="creditHours" id="creditHours">
            <option value="4">4</option>
            <option value="3" selected>3</option>
            <option value="2">2</option>
            <option value="1">1</option>
            <option value="0">0</option>
          </select>
        </div>
        <div class="form-group">
          <label for="grade">Grade:</label>
          <select name="grade" id="grade">
            <option value="4.0">A (4.0)</option>
            <option value="3.7">A- (3.7)</option>
            <option value="3.3">B+ (3.3)</option>
            <option value="3.0">B (3.0)</option>
            <option value="2.7">B- (2.7)</option>
            <option value="2.3">C+ (2.3)</option>
            <option value="2.0">C (2.0)</option>
            <option value="0">F (0)</option>
          </select>
        </div>
        <button type="button" id="addCourses" onclick="onSubmit()">Add</button>
        <div id="totalGPA"></div>
      </form>
      <div id="tableContainer"></div>
    </main>
    <footer></footer>
    <script>
      // Global variables
      var tableGenerated = false;
      var editingRow = null;
      var grandTotalPoints = 0;
      var totalCreditHours = 0;
      var totalGPA = 0;
      if (totalGPA === Infinity || totalGPA === NaN || totalGPA === -Infinity) {
        totalGPA = 0;
      }
      // Remove the entire table row when Remove is clicked.
      function removeElement() {
        var row = this.parentElement.parentElement;
        // Retrieve credit hours and grade as numbers from the row.
        var creditHours = parseFloat(row.cells[1].textContent);
        var grade = parseFloat(row.cells[2].textContent);

        // Update global totals.
        grandTotalPoints = grandTotalPoints - creditHours * grade;
        totalCreditHours = totalCreditHours - creditHours;
        totalGPA = grandTotalPoints / totalCreditHours;

        // Remove existing GPA display if any.
        if (document.getElementById("GPA")) {
          document.getElementById("GPA").remove();
        }

        // Use isNaN() to check if totalGPA is NaN, and also check for Infinity values.
        if (
          totalGPA === Infinity ||
          isNaN(totalGPA) ||
          totalGPA === -Infinity
        ) {
          totalGPA = 0;
        }

        // Create and display the updated GPA.
        var GPA = document.createElement("h3");
        GPA.id = "GPA";
        GPA.innerHTML = "Total GPA: " + totalGPA;
        document.getElementById("totalGPA").after(GPA);

        // Finally, remove the row.
        row.remove();
      }

      // Called when the Edit button is clicked.
      function editElement() {
        // Get the row containing the clicked button.
        var row = this.parentElement.parentElement;
        // Log the row index (for debugging).
        console.log("Editing row index:", row.rowIndex);

        // Retrieve current row values.
        var course = row.cells[0].textContent;
        var creditHours = row.cells[1].textContent;
        var grade = row.cells[2].textContent;

        // Populate the form fields.
        document.getElementById("course").value = course;
        document.getElementById("creditHours").value = creditHours;

        // Correctly set the grade in the dropdown
        var gradeSelect = document.getElementById("grade");
        gradeSelect.value = grade; // Ensure grade is a string matching the option's value

        // Set the global editingRow variable.
        editingRow = row;
        // Change the Add button to Update.
        document.getElementById("addCourses").textContent = "Update";
      }

      // Called when the Add/Update button is clicked.
      function onSubmit() {
        var form = document.getElementById("courseInfo");
        var formData = new FormData(form);
        var course = formData.get("course");
        var creditHours = formData.get("creditHours");
        var grade = formData.get("grade");

        // Remove existing warning if any.
        if (document.getElementById("warning")) {
          document.getElementById("warning").remove();
        }

        // Validate form fields.
        if (!course || !creditHours || !grade) {
          var warning = document.createElement("h3");
          warning.innerHTML = "Please fill all the fields!";
          warning.style.color = "red";
          warning.style.marginTop = "20px";
          warning.id = "warning";
          document.getElementById("addCourses").after(warning);
          return;
        }

        // Convert numeric values.
        creditHours = parseFloat(creditHours);
        grade = parseFloat(grade);

        // If editing, update the row.
        if (editingRow) {
          editingRow.cells[0].textContent = course;
          editingRow.cells[1].textContent = creditHours;
          editingRow.cells[2].textContent = grade;
          editingRow.cells[3].textContent = (creditHours * grade).toFixed(2);
          form.reset();
          editingRow = null;
          document.getElementById("addCourses").textContent = "Add";
          return;
        }

        // Create table if it doesn't exist.
        if (!tableGenerated) {
          var table = document.createElement("table");
          var theader = document.createElement("tr");

          var heading1 = document.createElement("th");
          var heading2 = document.createElement("th");
          var heading3 = document.createElement("th");
          var heading4 = document.createElement("th");
          var heading5 = document.createElement("th");

          heading1.innerHTML = "Course Name";
          heading2.innerHTML = "Credit Hours";
          heading3.innerHTML = "Grade";
          heading4.innerHTML = "Total Grade Points";
          heading5.innerHTML = "Action";

          // Optional styling for headings.
          [heading1, heading2, heading3, heading4, heading5].forEach(function (
            h
          ) {
            h.style.textShadow = "0 0 30px rgb(229, 234, 208)";
            h.style.textDecorationLine = "underline";
          });

          theader.appendChild(heading1);
          theader.appendChild(heading2);
          theader.appendChild(heading3);
          theader.appendChild(heading4);
          theader.appendChild(heading5);

          table.appendChild(theader);
          table.id = "userTable";

          // Insert table after the Add/Update button.
          document.getElementById("tableContainer").append(table);
          tableGenerated = true;
        }

        // Add a new row to the table.
        var table = document.getElementById("userTable");
        // Insert new row at index 1 (below header).
        var row = table.insertRow(1);
        var cell1 = row.insertCell(0);
        var cell2 = row.insertCell(1);
        var cell3 = row.insertCell(2);
        var cell4 = row.insertCell(3);
        var cell5 = row.insertCell(4);

        // Create Remove button.
        var removeButton = document.createElement("button");
        removeButton.innerHTML = "Remove";
        removeButton.onclick = removeElement;
        removeButton.className = "actionButton";
        cell5.appendChild(removeButton);

        // Create Edit button.
        var editButton = document.createElement("button");
        editButton.innerHTML = "Edit";
        editButton.onclick = editElement;
        editButton.className = "actionButton";
        cell5.appendChild(editButton);

        // Calculate total grade points.
        var totalPoints = creditHours * grade;

        cell1.innerHTML = course;
        cell2.innerHTML = creditHours;
        cell3.innerHTML = grade;
        cell4.innerHTML = totalPoints;
        grandTotalPoints = grandTotalPoints + totalPoints;
        totalCreditHours = totalCreditHours + creditHours;
        totalGPA = grandTotalPoints / totalCreditHours;

        console.log("Grand Total Points", grandTotalPoints);
        console.log("Total Credit Hours", totalCreditHours);
        console.log("Total GPA", totalGPA);

        if (document.getElementById("GPA")) {
          document.getElementById("GPA").remove();
        }

        var GPA = document.createElement("h3");
        GPA.id = "GPA";
        GPA.innerHTML = "Total GPA: " + totalGPA;
        document.getElementById("totalGPA").after(GPA);
        // Reset form.
        form.reset();
      }
    </script>
  </body>
</html>
